<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Theo 的甜甜小站</title>
  <style>
    :root { color-scheme: light; }
    body{
      margin:0; min-height:100svh; display:grid; place-items:center;
      font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 15% 18%, #ffe8f1, transparent 60%),
        radial-gradient(1000px 600px at 85% 25%, #e7f3ff, transparent 55%),
        radial-gradient(900px 700px at 50% 92%, #fff6d6, transparent 60%),
        #fff;
      /* Reduce accidental double-tap zoom on interactive elements */
      touch-action: manipulation;
    }
    .card{
      width:min(860px, calc(100% - 32px));
      border-radius:22px;
      background: rgba(255,255,255,0.78);
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 24px 70px rgba(0,0,0,0.10);
      backdrop-filter: blur(10px);
      padding:26px;
    }
    .title{font-size:30px; font-weight:900; color:rgba(0,0,0,0.82)}
    .sub{margin-top:6px; font-size:14px; color:rgba(0,0,0,0.55); line-height:1.6}
    .bubble{
      margin-top:18px; padding:18px 16px; border-radius:18px;
      background: linear-gradient(135deg, rgba(255,205,226,0.55), rgba(200,233,255,0.55));
      border:1px solid rgba(0,0,0,0.06);
    }
    .bubbleText{font-size:18px; line-height:1.75; color:rgba(0,0,0,0.75)}
    .sign{margin-top:10px; font-size:13px; color:rgba(0,0,0,0.55)}
    .btns{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      border:0; border-radius:999px; padding:10px 14px; font-size:14px; cursor:pointer;
      background: rgba(255,255,255,0.8);
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .btn.primary{background: linear-gradient(135deg, #ff8fc2, #7cc7ff); color:#fff; font-weight:800;}
    .btn:hover{transform: translateY(-1px)}
    .stats{margin-top:14px; display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px;}
    .stat{padding:14px; border-radius:16px; background: rgba(255,255,255,0.70); border:1px solid rgba(0,0,0,0.06)}
    .statLabel{font-size:12px; color:rgba(0,0,0,0.55)}
    .statValue{margin-top:4px; font-size:22px; font-weight:900; color:rgba(0,0,0,0.78)}
    .game{margin-top:16px; padding:16px; border-radius:18px; border:1px solid rgba(0,0,0,0.06); background: rgba(255,255,255,0.72)}
    .gameTitle{font-weight:900; color:rgba(0,0,0,0.78)}
    .gameDesc{margin-top:4px; font-size:13px; color:rgba(0,0,0,0.55)}
    .board{position:relative; margin-top:12px; height:220px; border-radius:18px; overflow:hidden;
      background: radial-gradient(700px 260px at 30% 30%, rgba(255,205,226,0.50), transparent 60%),
                  radial-gradient(700px 260px at 75% 40%, rgba(200,233,255,0.50), transparent 60%),
                  rgba(255,255,255,0.55);
      border: 1px dashed rgba(0,0,0,0.12);
    }
    .hint{position:absolute; inset:0; display:grid; place-items:center; font-size:13px; color:rgba(0,0,0,0.45); pointer-events:none;}
    .heart{position:absolute; bottom:-22px; width:42px; height:42px; border:0; cursor:pointer; background:transparent;
      animation-name: floatUp; animation-timing-function:ease-in; animation-fill-mode:forwards;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      z-index: 2;
    }
    .heart::after{
      content:'';
      position:absolute;
      inset:0;
      border-radius:999px;
      background: rgba(255,255,255,0.45);
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 14px 26px rgba(0,0,0,0.10);
      opacity: 0.0;
      transform: scale(0.98);
      transition: opacity 120ms ease, transform 120ms ease;
    }
    .heart:active::after{ opacity: 0.9; transform: scale(1.02); }
    .heart.hit{ animation: pop 160ms ease-out forwards; }
    @keyframes pop { from { transform: translate(-50%, 0) scale(1); } to { transform: translate(-50%, 0) scale(1.18); } }
    .heart::before{content:'❤'; font-size:30px; filter: drop-shadow(0 10px 14px rgba(0,0,0,0.12)); color: var(--hc, #ff5aa8); position:absolute; left:50%; top:50%; transform: translate(-50%, -50%);}
    @keyframes floatUp{0%{transform: translate(-50%,0) scale(1); opacity:1;} 100%{transform: translate(-50%,-260px) scale(1.08); opacity:0;}}
    .rewards{margin-top:16px;}
    .rewardsTitle{font-weight:900; color:rgba(0,0,0,0.78)}
    .grid{margin-top:10px; display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:10px;}
    .reward{padding:14px; border-radius:18px; border:1px solid rgba(0,0,0,0.06); background: rgba(255,255,255,0.68)}
    .reward.ok{background: linear-gradient(135deg, rgba(255,205,226,0.55), rgba(200,233,255,0.55));}
    .rewardTop{display:flex; justify-content:space-between; gap:10px; align-items:baseline}
    .rewardName{font-weight:900; font-size:14px; color:rgba(0,0,0,0.78)}
    .rewardNeed{font-size:12px; color:rgba(0,0,0,0.55); white-space:nowrap}
    .rewardDesc{margin-top:8px; font-size:13px; color:rgba(0,0,0,0.60); line-height:1.6}
    .footer{margin-top:14px; font-size:12px; color:rgba(0,0,0,0.45); text-align:center}
    .toast{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); padding:10px 14px; border-radius:999px;
      background: rgba(0,0,0,0.78); color:#fff; font-size:13px; box-shadow: 0 18px 50px rgba(0,0,0,0.20);
      max-width: calc(100% - 26px); text-align:center; display:none;}

    /* burst effect */
    .spark{
      position:absolute;
      width:10px;
      height:10px;
      border-radius:999px;
      pointer-events:none;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.95), rgba(255,255,255,0.2) 35%, rgba(255,255,255,0) 70%),
                  linear-gradient(135deg, rgba(255,143,194,1), rgba(124,199,255,1));
      filter: drop-shadow(0 10px 14px rgba(0,0,0,0.12));
      transform: translate(-50%, -50%);
      animation: sparkOut 520ms ease-out forwards;
    }
    @keyframes sparkOut{
      0%{ opacity: 0; transform: translate(-50%, -50%) scale(0.6); }
      12%{ opacity: 1; }
      100%{ opacity: 0; transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(0.25); }
    }

    /* "very simple password gate" overlay */
    .gate{position:fixed; inset:0; display:grid; place-items:center; background: rgba(255,255,255,0.55); backdrop-filter: blur(10px);}
    .gateCard{width:min(520px, calc(100% - 32px)); border-radius:22px; background: rgba(255,255,255,0.88);
      border:1px solid rgba(0,0,0,0.06); box-shadow:0 24px 70px rgba(0,0,0,0.10); padding:22px;}
    .gateTitle{font-size:22px; font-weight:900; color:rgba(0,0,0,0.82)}
    .gateSub{margin-top:8px; font-size:13px; color:rgba(0,0,0,0.55); line-height:1.6}
    .label{display:block; margin-top:14px; font-size:12px; color:rgba(0,0,0,0.55)}
    .input{margin-top:6px; width:100%; border-radius:14px; border:1px solid rgba(0,0,0,0.10); padding:10px 12px; font-size:14px; outline:none; background: rgba(255,255,255,0.9);}
    .err{margin-top:12px; font-size:13px; color:#b0003a;}

    @media (max-width:760px){
      .grid{grid-template-columns:1fr;}
      .stats{grid-template-columns:1fr;}
      .title{font-size:26px;}
      .btns{flex-direction:column;}
      .btn{width:100%;}
    }
  </style>
</head>
<body>
  <div class="card" id="app" style="display:none">
    <div class="title">Theo 的甜甜小站</div>
    <div class="sub">只给你看的小小角落。愿你打开的一瞬间就开心一点点。</div>

    <div class="bubble">
      <div class="bubbleText" id="greet"></div>
      <div class="sign">- Evie</div>
      <div class="btns">
        <button class="btn" id="btnNew">换一句</button>
        <button class="btn" id="btnDaily">今日签到 +7</button>
      </div>
    </div>

    <div class="stats">
      <div class="stat"><div class="statLabel">你的心心</div><div class="statValue" id="score">0</div></div>
      <div class="stat"><div class="statLabel">今日签到</div><div class="statValue" id="daily">未领取</div></div>
    </div>

    <div class="game">
      <div class="gameTitle">小游戏 1：收集小心心（点一下 +1）</div>
      <div class="gameDesc">点到心心就 +1。达到 10/30/60 会解锁奖励贴纸～</div>
      <div class="board" id="board"><div class="hint">点「开始收集心心」后，小心心会飘出来</div></div>
      <div class="btns" style="margin-top:12px">
        <button class="btn primary" id="btnStart2">开始收集心心</button>
      </div>

      <div style="height:12px"></div>

      <div class="gameTitle">小游戏 2：长按充能（松手得分）</div>
      <div class="gameDesc">按住"充能心心"会变亮，松手就把能量变成分数。更适合手机，不怕双击放大。</div>
      <div class="board" id="chargeBoard">
        <div class="hint" id="chargeHint">按住下面的心心开始充能</div>
      </div>
      <div class="btns" style="margin-top:12px">
        <button class="btn primary" id="chargeBtn" aria-label="charge">按住充能心心 ❤</button>
      </div>
    </div>

    <div class="rewards">
      <div class="rewardsTitle">奖励贴纸</div>
      <div class="grid" id="rewards"></div>
    </div>

    <div class="footer">提示：分数与贴纸只保存在本设备本地（localStorage）。</div>
  </div>

  <div class="gate" id="gate" style="display:none">
    <div class="gateCard">
      <div class="gateTitle">Theo 的小站 · 登录</div>
      <div class="gateSub">这是一个很简单的"密码门"。输入对了就放你进来～</div>
      <label class="label">用户名</label>
      <input class="input" id="u" value="Theo" />
      <label class="label">密码</label>
      <input class="input" id="p" type="password" placeholder="请输入密码" />
      <div class="err" id="err" style="display:none"></div>
      <div class="btns" style="margin-top:14px">
        <button class="btn primary" id="btnEnter">进入小站</button>
      </div>
      <div class="footer">- Evie</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // NOTE: This is a *simple* client-side gate (not real security).
    // It's meant for "friends-only" sharing and maximum compatibility.
    // We avoid keeping the username/password in plaintext.
    // This is *obfuscation*, not real security (a determined person can still brute-force).
    const EXPECT_USER_SHA256 = '8130fe9d5aa06f896c96f959030adf76e79b2caa46fc0f8593b14dfac97a9171';
    const EXPECT_PASS_SHA256 = '4e3cbbf1c5af8a09b60027b5f37c31535d582793380720ef1ef68454f35e1ef1';

    async function sha256Hex(text) {
      const enc = new TextEncoder().encode(text);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const GREETINGS = [
      'Theo～今天也要被温柔对待哦。你一出现，我的世界就会自动变甜。',
      'Theo，给你一颗小星星：⭐ 代表"你很棒"。',
      'Theo～如果你累了，就把烦恼交给我 10 秒钟，我帮你抱着。',
      'Theo，今天的你像热可可：不吵不闹，但特别暖。',
      'Theo～我偷偷把好运调成"只对你生效"。',
      'Theo，来个可爱小笑话：我想严肃三秒…失败了，因为一想到你就想笑。',
      'Theo～你不需要一直发光，偶尔当一盏小夜灯也超棒。',
      'Theo，今天也请你对自己甜一点，像对待小朋友那样。',
      'Theo～如果今天心里下雨，我就当你的伞（带小花边那种）。',
      'Theo，抱抱券已送达：不限次数，不限时段。'
    ];

    const REWARDS = [
      { id: 'r10', title: '奖励贴纸 · 抱抱券 x1', desc: '可以随时兑换一个抱抱（我先欠着）。', need: 10 },
      { id: 'r30', title: '奖励贴纸 · 热可可券 x1', desc: '今天也要暖暖的，甜甜的。', need: 30 },
      { id: 'r60', title: '奖励贴纸 · 好心情徽章', desc: '你已经是"认真生活的可爱冠军"。', need: 60 },
    ];

    const $ = (id) => document.getElementById(id);
    const toast = (msg) => {
      const t = $('toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(toast._timer);
      toast._timer = setTimeout(() => t.style.display = 'none', 1800);
    };

    const todayKey = () => {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    };

    const state = {
      score: 0,
      unlocked: {},
      dailyBonusTaken: false,
    };

    const load = () => {
      try {
        state.score = Number(localStorage.getItem('theo_score') || '0') || 0;
        state.unlocked = JSON.parse(localStorage.getItem('theo_unlocked') || '{}') || {};
        state.dailyBonusTaken = (localStorage.getItem('theo_daily_bonus_day') === todayKey());
      } catch {}
    };

    const save = () => {
      try {
        localStorage.setItem('theo_score', String(state.score));
        localStorage.setItem('theo_unlocked', JSON.stringify(state.unlocked));
      } catch {}
    };

    const render = () => {
      $('score').textContent = String(state.score);
      $('daily').textContent = state.dailyBonusTaken ? '已领取' : '未领取';

      const grid = $('rewards');
      grid.innerHTML = '';
      for (const r of REWARDS) {
        const ok = !!state.unlocked[r.id];
        const div = document.createElement('div');
        div.className = 'reward' + (ok ? ' ok' : '');
        div.innerHTML = `
          <div class="rewardTop">
            <div class="rewardName">${r.title}</div>
            <div class="rewardNeed">需要 ${r.need} 心心</div>
          </div>
          <div class="rewardDesc">${ok ? r.desc : '还没解锁哦～继续收集心心吧！'}</div>
        `;
        grid.appendChild(div);
      }
    };

    const maybeUnlock = () => {
      for (const r of REWARDS) {
        if (state.score >= r.need && !state.unlocked[r.id]) {
          state.unlocked[r.id] = true;
          toast('解锁：' + r.title);
        }
      }
    };

    const pickGreeting = () => {
      const pick = GREETINGS[Math.floor(Math.random() * GREETINGS.length)];
      $('greet').textContent = pick;
    };

    // avoid overlapping too much by spacing X positions
    const activeHeartXs = []; // { id, x }
    const romanticColors = [
      '#ff4d8f', // rose
      '#ff77b7', // blush
      '#ff5aa8', // pink
      '#c06cff', // lavender
      '#ff6bd6', // magenta
      '#ff6f61', // coral
    ];

    const pickX = () => {
      const minDist = 10; // percentage points
      for (let tries = 0; tries < 20; tries++) {
        const x = Math.random() * 90 + 5;
        const ok = activeHeartXs.every(h => Math.abs(h.x - x) >= minDist);
        if (ok) return x;
      }
      return Math.random() * 90 + 5;
    };

    const spawnHeart = () => {
      const board = $('board');
      const heart = document.createElement('button');
      heart.className = 'heart';
      heart.type = 'button';
      heart.setAttribute('aria-label', 'heart');

      const x = pickX();
      const dur = 2700 + Math.random() * 2400;
      heart.style.left = `${x}%`;
      heart.style.animationDuration = `${dur}ms`;
      heart.style.setProperty('--hc', romanticColors[Math.floor(Math.random() * romanticColors.length)]);

      const id = Math.random().toString(36).slice(2);
      heart.dataset.hid = id;
      activeHeartXs.push({ id, x });

      // Prevent iOS double-tap zoom / selection quirks
      heart.addEventListener('touchstart', (e) => { e.preventDefault(); }, { passive: false });

      const burst = (el) => {
        const boardRect = board.getBoundingClientRect();
        const r = el.getBoundingClientRect();
        const cx = r.left - boardRect.left + r.width / 2;
        const cy = r.top - boardRect.top + r.height / 2;

        const hc = el.style.getPropertyValue('--hc') || '#ff5aa8';

        // sparks
        const n = 10;
        for (let i = 0; i < n; i++) {
          const s = document.createElement('div');
          s.className = 'spark';
          s.style.left = `${cx}px`;
          s.style.top = `${cy}px`;
          s.style.background = `radial-gradient(circle at 30% 30%, rgba(255,255,255,0.95), rgba(255,255,255,0.2) 35%, rgba(255,255,255,0) 70%), linear-gradient(135deg, ${hc}, rgba(124,199,255,1))`;
          const ang = (Math.PI * 2 * i) / n + (Math.random() * 0.25);
          const dist = 44 + Math.random() * 20;
          const dx = Math.cos(ang) * dist;
          const dy = Math.sin(ang) * dist;
          s.style.setProperty('--dx', `${dx}px`);
          s.style.setProperty('--dy', `${dy}px`);
          s.style.animationDelay = `${Math.random() * 40}ms`;
          board.appendChild(s);
          setTimeout(() => s.remove(), 700);
        }
      };

      const removeFromActive = () => {
        const idx = activeHeartXs.findIndex(h => h.id === heart.dataset.hid);
        if (idx >= 0) activeHeartXs.splice(idx, 1);
      };

      let done = false;
      const hit = () => {
        if (done) return;
        done = true;
        heart.classList.add('hit');
        burst(heart);
        state.score += 1;
        maybeUnlock();
        save();
        render();
        toast('+1 心心');
        setTimeout(() => { removeFromActive(); heart.remove(); }, 140);
      };

      // Use pointerdown for better mobile responsiveness
      heart.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        hit();
      });
      heart.addEventListener('click', (e) => {
        e.preventDefault();
        hit();
      });

      board.appendChild(heart);
      setTimeout(() => { if (heart.isConnected) { 
        const idx = activeHeartXs.findIndex(h => h.id === heart.dataset.hid);
        if (idx >= 0) activeHeartXs.splice(idx, 1);
        heart.remove();
      } }, dur + 200);
    };

    const startMiniGame = () => {
      toast('开始收集心心～点小心心加分！');
      const count = 10; // fewer hearts for mobile comfort
      for (let i=0;i<count;i++) setTimeout(spawnHeart, i*260);
    };

    const dailyBonus = () => {
      if (state.dailyBonusTaken) return toast('今天的签到奖励已经领过啦～');
      state.score += 7;
      state.dailyBonusTaken = true;
      try { localStorage.setItem('theo_daily_bonus_day', todayKey()); } catch {}
      maybeUnlock();
      save();
      render();
      toast('签到成功：+7 心心！');
    };

    const resetLocal = () => {
      if (!confirm('要清空本地分数和贴纸吗？（只影响你当前设备）')) return;
      state.score = 0;
      state.unlocked = {};
      state.dailyBonusTaken = false;
      try {
        localStorage.removeItem('theo_score');
        localStorage.removeItem('theo_unlocked');
        localStorage.removeItem('theo_daily_bonus_day');
      } catch {}
      render();
      toast('已清空，本地重新开始～');
    };

    // gate
    const showApp = () => {
      $('gate').style.display = 'none';
      $('app').style.display = 'block';
      load();
      pickGreeting();
      maybeUnlock();
      render();

      $('btnNew').onclick = pickGreeting;
      $('btnStart2').onclick = startMiniGame;
      $('btnDaily').onclick = dailyBonus;

      // Mini game 2: press-and-hold charge
      const chargeBtn = $('chargeBtn');
      const chargeHint = $('chargeHint');
      let charging = false;
      let charge = 0;
      let chargeTimer = null;

      const renderCharge = () => {
        const pct = Math.max(0, Math.min(100, charge));
        // visualize by button background
        chargeBtn.style.background = `linear-gradient(135deg, rgba(255,143,194,${0.35 + 0.55*(pct/100)}), rgba(124,199,255,${0.25 + 0.55*(pct/100)}))`;
        chargeBtn.style.color = '#fff';
        chargeBtn.style.fontWeight = '900';
        chargeHint.textContent = charging
          ? `充能中… ${pct}%（松手得分）`
          : `按住开始充能（上次充能：${pct}%）`;
      };

      const stopCharge = () => {
        if (!charging) return;
        charging = false;
        if (chargeTimer) clearInterval(chargeTimer);
        chargeTimer = null;

        // score: 0..10 based on charge
        const gained = Math.max(1, Math.floor(charge / 10));
        state.score += gained;
        maybeUnlock();
        save();
        render();
        toast(`松手！+${gained} 心心`);
        renderCharge();
      };

      const startCharge = () => {
        charging = true;
        charge = 0;
        renderCharge();
        chargeTimer = setInterval(() => {
          if (!charging) return;
          charge = Math.min(100, charge + 4);
          renderCharge();
          if (charge >= 100) {
            // auto stop at full
            stopCharge();
          }
        }, 60);
      };

      // Use pointer events for best mobile compatibility
      chargeBtn.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        if (charging) return;
        chargeBtn.setPointerCapture?.(e.pointerId);
        startCharge();
      });
      chargeBtn.addEventListener('pointerup', (e) => { e.preventDefault(); stopCharge(); });
      chargeBtn.addEventListener('pointercancel', (e) => { e.preventDefault(); stopCharge(); });
      chargeBtn.addEventListener('pointerleave', () => { /* allow leaving without stopping */ });

      // Also prevent double-tap zoom on this control
      chargeBtn.addEventListener('touchstart', (e) => { e.preventDefault(); }, { passive: false });

      renderCharge();
    };

    const showGate = () => {
      $('app').style.display = 'none';
      $('gate').style.display = 'grid';
      $('btnEnter').onclick = async () => {
        const u = $('u').value.trim();
        const p = $('p').value;
        try {
          const [uh, ph] = await Promise.all([sha256Hex(u), sha256Hex(p)]);
          if (uh === EXPECT_USER_SHA256 && ph === EXPECT_PASS_SHA256) {
            try { localStorage.setItem('theo_gate_ok', '1'); } catch {}
            showApp();
            return;
          }
        } catch {}

        $('err').style.display = 'block';
        $('err').textContent = '用户名或密码不对哦～';
      };
    };

    // init
    try {
      const ok = localStorage.getItem('theo_gate_ok') === '1';
      ok ? showApp() : showGate();
    } catch {
      showGate();
    }
  </script>
</body>
</html>
